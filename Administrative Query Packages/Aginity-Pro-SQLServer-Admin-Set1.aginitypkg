{"entities":[{"fqn":"/Samples","id":"05fc0bd0-3f7c-4113-a7a5-2a321b32a790","parent_folder_id":"bb6de4af-1aad-493e-a9ee-b3e75cf58ed7","name":"Samples","entity_type":"FOLDER"},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin","id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","parent_folder_id":"e6980c49-7abd-44ef-879e-4079dbad44d4","name":"Admin","entity_type":"FOLDER"},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin/Show Sizes For All Databases","id":"217bbe1b-5cb4-4c1d-97b2-cff61e7cebc7","parent_folder_id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","name":"Show Sizes For All Databases","entity_type":"SQL_ENTITY","description":"","content":"---\r\nSELECT\r\n    d.name AS 'Database',\r\n    m.name AS 'File',\r\n    m.size * 8/1024 'Size (MB)',\r\n    SUM(m.size * 8/1024) OVER (PARTITION BY d.name) AS 'Database Total'\r\nFROM sys.master_files m\r\nINNER JOIN sys.databases d ON\r\nd.database_id = m.database_id","type":"QUERY","platform":"Snowflake","executed_count":0},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin/Get Index Usage Statistics For Current Database","id":"2bcea652-5164-4087-82be-6b8fd6f81f58","parent_folder_id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","name":"Get Index Usage Statistics For Current Database","entity_type":"SQL_ENTITY","description":"","content":"select \r\n\tr.create_date as table_create_date,\r\n\tdb_name(db_id()) + '.[' + object_schema_name(r.object_id) + '].[' + object_name(r.object_id) + ']' as table_name\r\n\t\t,rr.type_desc\r\n\t\t,rr.index_name\r\n\t\t,[user_seeks]\r\n\t\t,[user_scans]\r\n\t\t,[user_lookups]\r\n\t\t,[user_updates]\r\n\t\t,[last_user_seek]\r\n\t\t,[last_user_scan]\r\n\t\t,[last_user_lookup]\r\n\t\t,[last_user_update]\r\n\t\t,[system_seeks]\r\n\t\t,[system_scans]\r\n\t\t,[system_lookups]\r\n\t\t,[system_updates]\r\n\t\t,[last_system_seek]\r\n\t\t,[last_system_scan]\r\n\t\t,[last_system_lookup]\r\n\t\t,[last_system_update]\r\nfrom sys.tables r\r\nleft join (\r\n\tselect \r\n\t\t r.object_id\r\n\t\t,i.name index_name\r\n\t\t,[user_seeks]\r\n\t\t,[user_scans]\r\n\t\t,[user_lookups]\r\n\t\t,[user_updates]\r\n\t\t,[last_user_seek]\r\n\t\t,[last_user_scan]\r\n\t\t,[last_user_lookup]\r\n\t\t,[last_user_update]\r\n\t\t,[system_seeks]\r\n\t\t,[system_scans]\r\n\t\t,[system_lookups]\r\n\t\t,[system_updates]\r\n\t\t,[last_system_seek]\r\n\t\t,[last_system_scan]\r\n\t\t,[last_system_lookup]\r\n\t\t,[last_system_update]\r\n\t\t,i.type\r\n\t\t,i.type_desc\r\n\tfrom [sys].[dm_db_index_usage_stats] r\r\n\tinner join sys.indexes i on i.object_id = r.object_id\r\n\t\tand i.index_id = r.index_id\r\n\t) rr on rr.object_id = r.object_id","type":"QUERY","platform":"Snowflake","executed_at":"2019-09-13T11:59:17.382Z","executed_count":4},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin/Performance Statistics For Cached Query Plans (Top 20 Longest)","id":"39299fc2-eac6-4627-97d0-7c0c9707b0d3","parent_folder_id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","name":"Performance Statistics For Cached Query Plans (Top 20 Longest)","entity_type":"SQL_ENTITY","description":"","content":"---\r\nselect top 20 SUBSTRING(ST.text, (QS.statement_start_offset / 2) + 1, (\r\n\t\t\t(\r\n\t\t\t\tcase statement_end_offset\r\n\t\t\t\t\twhen - 1\r\n\t\t\t\t\t\tthen DATALENGTH(ST.text)\r\n\t\t\t\t\telse QS.statement_end_offset\r\n\t\t\t\t\tend - QS.statement_start_offset\r\n\t\t\t\t) / 2\r\n\t\t\t) + 1) as \"Statement Text\"\r\n\t,total_worker_time / execution_count / 1000 as \"Average Worker Time (ms)\"\r\n\t,execution_count as \"Execution Count\"\r\n\t,total_worker_time / 1000 as \"Total Worker Time (ms)\"\r\n\t,total_logical_reads as \"Total Logical Reads\"\r\n\t,total_logical_reads / execution_count as \"Average Logical Reads\"\r\n\t,total_elapsed_time / 1000 as \"Total Elapsed Time (ms)\"\r\n\t,total_elapsed_time / execution_count / 1000 as \"Average Elapsed Time (ms)\"\t\r\nfrom sys.dm_exec_query_stats QS\r\ncross apply sys.dm_exec_sql_text(QS.sql_handle) ST\r\norder by total_elapsed_time / execution_count desc","type":"QUERY","platform":"Snowflake","executed_at":"2019-09-13T11:58:53.833Z","executed_count":1},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin/Top 10 Biggest Tables In Current Database","id":"669b7cee-d07b-4737-b0de-09da4eff6c2f","parent_folder_id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","name":"Top 10 Biggest Tables In Current Database","entity_type":"SQL_ENTITY","description":"","content":"---\r\nselect top 10 \r\n\t a3.name as [schemaname]\r\n\t,a2.name as [tablename]\r\n\t,a1.rows as row_count\r\n\t,(a1.reserved + ISNULL(a4.reserved, 0)) * 8 as reserved\r\n\t,a1.data * 8 as data\r\n\t,(\r\n\t\tcase \r\n\t\t\twhen (a1.used + ISNULL(a4.used, 0)) > a1.data\r\n\t\t\t\tthen (a1.used + ISNULL(a4.used, 0)) - a1.data\r\n\t\t\telse 0\r\n\t\t\tend\r\n\t\t) * 8 as index_size\r\n\t,(\r\n\t\tcase \r\n\t\t\twhen (a1.reserved + ISNULL(a4.reserved, 0)) > a1.used\r\n\t\t\t\tthen (a1.reserved + ISNULL(a4.reserved, 0)) - a1.used\r\n\t\t\telse 0\r\n\t\t\tend\r\n\t\t) * 8 as unused\r\nfrom (\r\n\tselect ps.object_id\r\n\t\t,SUM(case \r\n\t\t\t\twhen (ps.index_id < 2)\r\n\t\t\t\t\tthen row_count\r\n\t\t\t\telse 0\r\n\t\t\t\tend) as [rows]\r\n\t\t,SUM(ps.reserved_page_count) as reserved\r\n\t\t,SUM(case \r\n\t\t\t\twhen (ps.index_id < 2)\r\n\t\t\t\t\tthen (ps.in_row_data_page_count + ps.lob_used_page_count + ps.row_overflow_used_page_count)\r\n\t\t\t\telse (ps.lob_used_page_count + ps.row_overflow_used_page_count)\r\n\t\t\t\tend) as data\r\n\t\t,SUM(ps.used_page_count) as used\r\n\tfrom sys.dm_db_partition_stats ps\r\n\twhere ps.object_id not in (\r\n\t\t\tselect object_id\r\n\t\t\tfrom sys.tables\r\n\t\t\twhere is_memory_optimized = 1\r\n\t\t\t)\r\n\tgroup by ps.object_id\r\n\t) as a1\r\nleft outer join (\r\n\tselect it.parent_id\r\n\t\t,SUM(ps.reserved_page_count) as reserved\r\n\t\t,SUM(ps.used_page_count) as used\r\n\tfrom sys.dm_db_partition_stats ps\r\n\tinner join sys.internal_tables it on (it.object_id = ps.object_id)\r\n\twhere it.internal_type in (\r\n\t\t\t202\r\n\t\t\t,204\r\n\t\t\t)\r\n\tgroup by it.parent_id\r\n\t) as a4 on (a4.parent_id = a1.object_id)\r\ninner join sys.all_objects a2 on (a1.object_id = a2.object_id)\r\ninner join sys.schemas a3 on (a2.schema_id = a3.schema_id)\r\nwhere a2.type <> N'S'\r\n\tand a2.type <> N'IT'\r\norder by 4 desc","type":"QUERY","platform":"Snowflake","executed_count":0},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin/Show Unused Tables Since Last Restart","id":"8fcbc29e-25e6-4e21-80cc-9405fb7b8e3e","parent_folder_id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","name":"Show Unused Tables Since Last Restart","entity_type":"SQL_ENTITY","description":"","content":"---\r\n@{/Samples/Sample Data Engineering Queries - SQL Server/Admin/Get Index Usage Statistics For Current Database}\r\nwhere \r\n\tisnull(rr.type,0) in (0,1)\r\n\tand isnull(user_seeks + user_scans + user_lookups + user_updates,0) = 0","type":"QUERY","platform":"Snowflake","executed_at":"2019-09-13T11:59:17.374Z","executed_count":1},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin/Performance Killer Wait Types Found","id":"ba9c8105-5ec4-4d3c-839a-47e403babcdb","parent_folder_id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","name":"Performance Killer Wait Types Found","entity_type":"SQL_ENTITY","description":"","content":"---\r\nselect wait_type\r\n\t,concat (\r\n\t\t((SUM([wait_time_ms]) / 1000) / 86400)\r\n\t\t,':'\r\n\t\t,convert(varchar(20), DATEADD(s, (SUM([wait_time_ms]) / 1000), 0), 108)\r\n\t\t) WaitTime\r\nfrom sys.[dm_os_wait_stats]\r\nwhere wait_type in (\r\n\t\t'IO_QUEUE_LIMIT'\r\n\t\t,'IO_RETRY'\r\n\t\t,'LOG_RATE_GOVERNOR'\r\n\t\t,'POOL_LOG_RATE_GOVERNOR'\r\n\t\t,'PREEMPTIVE_DEBUG'\r\n\t\t,'RESMGR_THROTTLED'\r\n\t\t,'RESOURCE_SEMAPHORE'\r\n\t\t,'RESOURCE_SEMAPHORE_QUERY_COMPILE'\r\n\t\t,'SE_REPL_CATCHUP_THROTTLE'\r\n\t\t,'SE_REPL_COMMIT_ACK'\r\n\t\t,'SE_REPL_COMMIT_TURN'\r\n\t\t,'SE_REPL_ROLLBACK_ACK'\r\n\t\t,'SE_REPL_SLOW_SECONDARY_THROTTLE'\r\n\t\t,'THREADPOOL'\r\n\t\t)\r\ngroup by wait_type\r\nhaving SUM([wait_time_ms]) > 0","type":"QUERY","platform":"Snowflake","executed_at":"2019-09-13T11:58:45.560Z","executed_count":1},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server","id":"e6980c49-7abd-44ef-879e-4079dbad44d4","parent_folder_id":"05fc0bd0-3f7c-4113-a7a5-2a321b32a790","name":"Sample Data Engineering Queries - SQL Server","entity_type":"FOLDER"},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin/Show List Of Active Processes With SQL Text","id":"ea8b6fff-7086-4d83-b894-0f634a5fce18","parent_folder_id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","name":"Show List Of Active Processes With SQL Text","entity_type":"SQL_ENTITY","description":"","content":"---\r\nselect qs.session_id\r\n\t,qs.blocking_session_id\r\n\t,qs.database_id\r\n\t,qs.percent_complete\r\n\t,qs.start_time\r\n\t,qs.status\r\n\t,qs.command\r\n\t,qs.cpu_time\r\n\t,qs.total_elapsed_time\r\n\t,qs.wait_type\r\n\t,ss.[host_name]\r\n\t,ss.[program_name]\r\n\t,ss.login_name\r\n\t,st.text\r\nfrom sys.dm_exec_requests qs\r\ncross apply sys.dm_exec_sql_text(qs.sql_handle) as st\r\ninner join sys.dm_exec_sessions ss on ss.session_id = qs.session_id\r\n","type":"QUERY","platform":"Snowflake","executed_at":"2019-09-13T11:59:08.075Z","executed_count":1},{"fqn":"/Samples/Sample Data Engineering Queries - SQL Server/Admin/User Statistics","id":"f0de3ae7-f50c-45a3-9878-2480a12b40bc","parent_folder_id":"168b90ad-f7b3-4d12-8cd2-e5e02c54f0ca","name":"User Statistics","entity_type":"SQL_ENTITY","description":"","content":"---\r\n\r\n                select (dense_rank() over(order by login_name,nt_user_name))%2 as row_num\r\n                ,       (row_number() over(order by login_name,nt_user_name,sessions.session_id))%2 as session_num\r\n                ,       login_name\r\n                ,       nt_user_name\r\n                ,       sessions.session_id as session_id\r\n                ,       count(distinct connections.connection_id) as connection_count\r\n                ,       count(distinct convert(char,sessions.session_id)+'_'+convert(char,requests.request_id)) as request_count\r\n                ,       count(distinct cursors.cursor_id) as cursor_count\r\n                ,       case when sum(requests.open_tran) is null\r\n                then 0\r\n                else  sum(requests.open_tran) end as transaction_count\r\n                ,       sessions.cpu_time+0.0 as cpu_time\r\n                ,       sessions.memory_usage * 8 as memory_usage\r\n                ,       sessions.reads as reads\r\n                ,       sessions.writes as writes\r\n                ,       sessions.last_request_start_time as last_request_start_time\r\n                ,       sessions.last_request_end_time as last_request_end_time\r\n                from sys.dm_exec_sessions sessions\r\n                left outer join sys.dm_exec_connections connections on sessions.session_id = connections.session_id\r\n                left outer join master..sysprocesses requests on sessions.session_id = requests.spid\r\n                left outer join sys.dm_exec_cursors(null) cursors on sessions.session_id = cursors.session_id\r\n                where (sessions.is_user_process = 1 and requests.dbid = DB_ID())\r\n                group by sessions.login_name,sessions.nt_user_name,sessions.session_id,sessions.cpu_time,sessions.memory_usage,sessions.reads,sessions.writes,sessions.last_request_start_time,sessions.last_request_end_time","type":"QUERY","platform":"Snowflake","executed_count":0}]}